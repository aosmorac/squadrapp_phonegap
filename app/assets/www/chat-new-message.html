
		<section class="header">
			<a class="cancel" onclick="closeNewMessage();"> Cancelar </a>
			<div class="title">Nuevo Mensaje</div>
		</section>
		
			<section class="members">
				<div class="label">Participantes (0/30)</div> 
				<div contenteditable="true" class="members-input"></div>
			</section>
		<div class="corte"> </div>
		<section class="header header-list">
					Amigos Locales - <span class="user-location"></span>
		</section>
		<div id="list-contacts"><div>
			<section class="local-list"> 
				<div id="local-list-start"></div>
				<ul id="local-contacts"> </ul>
			</section>
			<section class="world-list"> 
				<div id="world-list-start"></div>
				<section class="header">
					Amigos en el resto del mundo
				</section>
				<ul id="foreign-contacts"> </ul>
			</section>
		</diV></div>
		
		<div id="message-form"><form action="javascript:newChat();">
			<div class="fcontainer">
				<input type="text" placeholder="Mensaje" name="message" class="field" id="message-input">
			</div>
			<button>Enviar</button>
		</form></div>		 
		

<script>

	var group_contacts = Object;

	$('.check').bind('click' , function(){
				if ($(this).attr('class') == 'check selected') {
					$(this).removeClass('selected');
				}else{
					$(this).addClass('selected');
				};
			});
			
	
		$('.user-location').html(squadrapp.user.getUserCity());
	loadLocalContacts();
	loadForeignContacts();
	
	contactsScroll = new iScroll('list-contacts');
	
	$('#list-contacts').height($(window).height()-167);
	$('.members-input').width($(window).width()-133);
	
	contactsScroll.refresh();
	
	function CheckClick(uid){
		if ($('#contact_'+uid).attr('class') == 'check selected') {
			$('#contact_'+uid).removeClass('selected');
			$('#contactbygroup_'+uid).remove();
			delete group_contacts[uid];
		}else{
			group_contacts[uid] = squadrapp.user.getContact(uid);
			$('.input-span').remove();
			$(".members-input").append('<div contenteditable="false" id="contactbygroup_'+uid+'" class="selected">'+group_contacts[uid].name+'</div><span contenteditable="true" class="input-span">,</span>');
			$('#contact_'+uid).addClass('selected');
			$(".members-input").scrollTop($(".members-input")[0].scrollHeight);
		};
	}
	
	function removeSelected(){
		$('.selected').remove();
	}
	
	function newChat(){
		alert(1);
		var message = $('#message-input').val();
		$('#message-input').val('');
		var user_ids = getObjectKeys(group_contacts);
		if (user_ids != '' && jQuery.trim(message) != ''){
			squadrapp.nav.newChat(user_ids, jQuery.trim(message), function(){
				if (group_contacts.length == 1){
					closeNewMessage();
					goChatEvent(user_ids);
				}else if (group_contacts.length > 1){
					closeNewMessage();alert(2);
					goChatEvent(group_id, 1);	/*group_id var creada en squadrapp.nav.newChat*/
				}
			});
		}
	}

	
	/*
	 * Devuelve las llaves de un objeto separadas por comas.
	 * Return String
	 */
	function getObjectKeys(obj){
		var result = '';
		$.each( obj, function( key, element ) {
			if (result != '') {
				result += ',';
			}
			result += key;
		});
		return result;
	}
	
	
</script>